Objective
 - Cut down grunt work , the user will merely have to raise a request and direct it if they wish to
 - For Data-analysis
 - descritptive statistics
 - visualizations
 - inferential statistics from context (user provided + browsing)
 - All of the above done synthetically - with near 0 human interference

Architecture
 - Models 
    - Gemini - for mvp
    - RL-Env Finetuned 27B model if i find good outputs

 - ContextEngine
    - label facts and important datapoints
    - raw-data-structure --> (a table stored with the attributes with units and population and overral descritption of the data) and of course link this to the raw-data
                         -->  {
                              "datasets": {
                                 "dataset_001": {
                                    "name": "Q3_Sales_Data",
                                    "source": "sales_system.csv",
                                    "description": "Quarterly sales performance by region and product",
                                    "date_created": "2025-01-15",
                                    "rows": 15420,
                                    "columns": 8,
                                    "attributes": {
                                    "region": {"type": "categorical", "desc": "Geographic sales region", "values": ["North", "South", "East", "West"]},
                                    "revenue": {"type": "numeric", "desc": "Total revenue in USD", "unit": "dollars", "range": [1000, 50000]},
                                    "units_sold": {"type": "numeric", "desc": "Number of units sold", "unit": "count", "range": [10, 500]},
                                    "product_id": {"type": "categorical", "desc": "Unique product identifier", "format": "PROD_XXXX"},
                                    "date": {"type": "datetime", "desc": "Transaction date", "format": "YYYY-MM-DD"},
                                    "customer_type": {"type": "categorical", "desc": "Customer segment classification", "values": ["enterprise", "mid_market", "smb"]}
                                    },
                                    "relationships": {
                                    "links_to": ["dataset_002"],
                                    "join_keys": {"dataset_002": "product_id"},
                                    "derived_from": null,
                                    "generates": ["dataset_003"]
                                    },
                                    "quality_metrics": {
                                    "completeness": 0.98,
                                    "accuracy": 0.95,
                                    "freshness_days": 2
                                    }
                                 }
                              }
                              }
    - fact               --> {
                              "facts": {
                                 "fact_001": {
                                    "statement": "West region shows 23.4% revenue growth compared to Q2",
                                    "confidence": 0.89,
                                    "type": "statistical_finding",
                                    "source_dataset": "dataset_001",
                                    "attributes_used": ["region", "revenue", "date"],
                                    "calculation": {
                                    "formula": "((Q3_west_revenue - Q2_west_revenue) / Q2_west_revenue) * 100",
                                    "method": "percentage_change",
                                    "aggregation": "sum",
                                    "filters_applied": ["region='West'", "date BETWEEN '2024-07-01' AND '2024-09-30'"]
                                    },
                                    "supporting_values": {
                                    "Q3_west_revenue": 2450000,
                                    "Q2_west_revenue": 1985000,
                                    "absolute_change": 465000,
                                    "sample_size": 1240,
                                    "transaction_count": 3420,
                                    "average_deal_size": 716.37,
                                    "std_deviation": 245.67,
                                    "min_value": 1200,
                                    "max_value": 48500,
                                    "median": 650,
                                    "quartiles": [420, 650, 980]
                                    },
                                    "data_quality": {
                                    "completeness": 0.97,
                                    "outliers_detected": 12,
                                    "missing_values": 38,
                                    "data_validation_passed": true
                                    },
                                    "comparative_context": {
                                    "compared_to": "Q2_2024",
                                    "benchmark_value": 1985000,
                                    "peer_regions": {
                                       "North": {"value": 2100000, "growth": "18.2%"},
                                       "South": {"value": 1890000, "growth": "12.1%"},
                                       "East": {"value": 2200000, "growth": "15.8%"}
                                    },
                                    "industry_benchmark": 0.164,
                                    "historical_trend": ["Q1: -2.3%", "Q2: +8.1%", "Q3: +23.4%"]
                                    },
                                    "statistical_significance": {
                                    "p_value": 0.032,
                                    "confidence_interval": [0.21, 0.257],
                                    "test_used": "t_test",
                                    "degrees_freedom": 1238
                                    },
                                    "extraction_metadata": {
                                    "date_extracted": "2025-01-15T14:30:22Z",
                                    "extraction_method": "automated_analysis",
                                    "analyst": "llm_system",
                                    "validation_status": "peer_reviewed",
                                    "last_updated": "2025-01-15T14:30:22Z"
                                    },
                                    "linked_contexts": ["ctx_001", "ctx_003"],
                                    "linked_facts": ["fact_002", "fact_007"],
                                    "generates_insights": ["insight_001"],
                                    "flags": {
                                    "anomaly": false,
                                    "high_impact": true,
                                    "requires_followup": true
                                    }
                                 }
                              }
                              }
    - context            --> Whatever subjective information is given regarding a situation <linking articles or analysis to a certain data point (date and location)>
                         -->  {
                              "context": {
                                 "ctx_001": {
                                    "type": "temporal",
                                    "title": "Holiday Season Impact",
                                    "description": "Q3 includes back-to-school and early holiday shopping period affecting West region sales patterns",
                                    "applies_to_datasets": ["dataset_001", "dataset_003"],
                                    "applies_to_facts": ["fact_001", "fact_004"],
                                    "applies_to_requests": ["req_002"],
                                    "scope": {
                                    "geographic": ["West region", "California", "Nevada", "Oregon"],
                                    "temporal": {
                                       "start_date": "2024-07-01",
                                       "end_date": "2024-09-30",
                                       "specific_events": ["back_to_school: Aug 15-31", "labor_day: Sep 2"]
                                    },
                                    "demographic": ["families", "students", "young_professionals"],
                                    "product_categories": ["electronics", "clothing", "home_goods"]
                                    },
                                    "relevance_score": 0.82,
                                    "confidence": 0.91,
                                    "source": {
                                    "type": "domain_knowledge",
                                    "references": ["market_research_2024", "historical_patterns"],
                                    "expert_input": "retail_analyst_team",
                                    "validation_method": "historical_correlation"
                                    },
                                    "quantitative_impact": {
                                    "seasonal_multiplier": 1.15,
                                    "expected_variance": 0.08,
                                    "correlation_coefficient": 0.73,
                                    "historical_consistency": 0.89
                                    },
                                    "qualitative_factors": {
                                    "market_sentiment": "optimistic",
                                    "consumer_behavior": "increased_spending",
                                    "competitive_landscape": "moderate_competition",
                                    "economic_indicators": ["consumer_confidence: high", "unemployment: low"]
                                    },
                                    "metadata": {
                                    "created_date": "2025-01-15T10:15:00Z",
                                    "last_updated": "2025-01-15T16:22:00Z",
                                    "created_by": "llm_system",
                                    "validation_status": "confirmed",
                                    "usage_count": 15
                                    },
                                    "relationships": {
                                    "contradicts": [],
                                    "supports": ["ctx_003", "ctx_007"],
                                    "similar_contexts": ["ctx_012", "ctx_018"],
                                    "parent_context": "ctx_000_annual_trends"
                                    }
                                 }
                              }
                              }

    - requests           --> previous requests and their corresponding response
                         --> {
                              "requests": {
                                 "req_001": {
                                    "query": "What's driving the exceptional growth in West region revenue during Q3?",
                                    "timestamp": "2025-01-15T10:30:00Z",
                                    "user_id": "analyst_001",
                                    "session_context": "quarterly_review_meeting",
                                    "request_type": "analytical_inquiry",
                                    "intent_classification": {
                                    "primary": "causal_analysis",
                                    "secondary": ["trend_identification", "performance_comparison"],
                                    "confidence": 0.94
                                    },
                                    "data_requirements": {
                                    "datasets_requested": ["dataset_001"],
                                    "datasets_accessed": ["dataset_001", "dataset_002"],
                                    "attributes_needed": ["region", "revenue", "date", "product_category"],
                                    "time_range": "Q2-Q3 2024",
                                    "aggregation_level": "regional"
                                    },
                                    "analysis_scope": {
                                    "geographic_focus": ["West"],
                                    "comparison_periods": ["Q2_2024", "Q3_2023"],
                                    "metrics_of_interest": ["revenue_growth", "market_share", "customer_acquisition"],
                                    "depth_level": "detailed_breakdown"
                                    },
                                    "processing_metadata": {
                                    "complexity_score": 0.72,
                                    "estimated_compute_time": "45_seconds",
                                    "priority": "high",
                                    "processing_status": "completed",
                                    "response_generated": "res_001"
                                    },
                                    "linked_entities": {
                                    "generated_facts": ["fact_001", "fact_002"],
                                    "used_contexts": ["ctx_001", "ctx_003"],
                                    "triggered_scripts": ["script_001", "script_003"],
                                    "produced_results": ["result_001"],
                                    "response_id": "res_001"
                                    },
                                    "user_context": {
                                    "previous_related_queries": ["req_000"],
                                    "expertise_level": "intermediate",
                                    "preferred_output_format": "detailed_with_visualizations",
                                    "follow_up_questions": ["req_002", "req_003"]
                                    }
                                 }
                              }
                              }
    - scritps            --> scripts pertaining to a request
                         --> {
                              "scripts": {
                                 "script_001": {
                                    "name": "regional_growth_analysis",
                                    "description": "Calculates revenue growth by region with statistical significance testing",
                                    "triggered_by_request": "req_001",
                                    "language": "python",
                                    "script_type": "analytical",
                                    "code": "import pandas as pd\nimport numpy as np\nfrom scipy import stats\n\ndef analyze_regional_growth(df, region, periods):\n    # Filter data for specific region\n    region_data = df[df['region'] == region]\n    \n    # Calculate growth metrics\n    q2_revenue = region_data[region_data['quarter'] == 'Q2']['revenue'].sum()\n    q3_revenue = region_data[region_data['quarter'] == 'Q3']['revenue'].sum()\n    \n    growth_rate = ((q3_revenue - q2_revenue) / q2_revenue) * 100\n    \n    # Statistical significance\n    t_stat, p_value = stats.ttest_rel(q3_data, q2_data)\n    \n    return {\n        'growth_rate': growth_rate,\n        'q2_revenue': q2_revenue,\n        'q3_revenue': q3_revenue,\n        'p_value': p_value,\n        'significant': p_value < 0.05\n    }",
                                    "execution_metadata": {
                                    "created_date": "2025-01-15T10:32:15Z",
                                    "executed_date": "2025-01-15T10:32:45Z",
                                    "execution_time": "2.3_seconds",
                                    "status": "success",
                                    "version": "1.0",
                                    "hash": "a7b9c2d1e8f4g6h2"
                                    },
                                    "dependencies": {
                                    "libraries": ["pandas==1.5.3", "numpy==1.24.3", "scipy==1.10.1"],
                                    "datasets": ["dataset_001"],
                                    "external_data": [],
                                    "environment": "python_3.9"
                                    },
                                    "parameters": {
                                    "input_params": {
                                       "region": "West",
                                       "comparison_periods": ["Q2_2024", "Q3_2024"],
                                       "confidence_level": 0.95
                                    },
                                    "configurable_params": {
                                       "aggregation_method": "sum",
                                       "outlier_threshold": 3,
                                       "minimum_sample_size": 100
                                    }
                                    },
                                    "validation": {
                                    "syntax_valid": true,
                                    "logic_reviewed": true,
                                    "test_cases_passed": 8,
                                    "peer_reviewed": true,
                                    "security_scan": "passed"
                                    },
                                    "performance": {
                                    "memory_usage": "45MB",
                                    "cpu_time": "2.1_seconds",
                                    "optimization_score": 0.87,
                                    "scalability_rating": "good"
                                    },
                                    "relationships": {
                                    "generates_results": ["result_001"],
                                    "uses_facts": ["fact_001"],
                                    "references_contexts": ["ctx_001"],
                                    "parent_script": null,
                                    "derived_scripts": ["script_004"]
                                    }
                                 }
                              }
                              }
    - results            --> raw-data-structure basically all the mentioned variables can be added to another fresh dataset if needed
                         --> {
                              "results": {
                                 "result_001": {
                                    "name": "west_region_growth_analysis_output",
                                    "description": "Statistical analysis results for West region Q3 revenue growth",
                                    "generated_by_script": "script_001",
                                    "triggered_by_request": "req_001",
                                    "execution_timestamp": "2025-01-15T10:32:45Z",
                                    "result_type": "analytical_output",
                                    "data_format": "structured_json",
                                    "output_data": {
                                    "primary_metrics": {
                                       "growth_rate": 23.4,
                                       "q2_revenue": 1985000,
                                       "q3_revenue": 2450000,
                                       "absolute_change": 465000,
                                       "percentage_change": 0.234
                                    },
                                    "statistical_validation": {
                                       "p_value": 0.032,
                                       "t_statistic": 2.847,
                                       "confidence_interval": [0.21, 0.257],
                                       "degrees_freedom": 1238,
                                       "significant": true
                                    },
                                    "supporting_analysis": {
                                       "sample_size": 1240,
                                       "outliers_removed": 12,
                                       "data_completeness": 0.97,
                                       "variance": 0.0034,
                                       "standard_error": 0.058
                                    },
                                    "comparative_context": {
                                       "peer_regions": {
                                          "North": {"growth": 18.2, "revenue": 2100000},
                                          "South": {"growth": 12.1, "revenue": 1890000},
                                          "East": {"growth": 15.8, "revenue": 2200000}
                                       },
                                       "rank_among_regions": 1,
                                       "above_average_by": 8.7
                                    }
                                    },
                                    "quality_assessment": {
                                    "accuracy_score": 0.96,
                                    "completeness": 0.98,
                                    "reliability": 0.94,
                                    "validation_passed": true,
                                    "anomalies_detected": 0
                                    },
                                    "output_artifacts": {
                                    "files_generated": ["west_region_analysis.csv", "growth_chart.png"],
                                    "visualizations": ["time_series_plot", "comparison_bar_chart"],
                                    "summary_report": "west_region_summary.pdf",
                                    "exportable_data": true
                                    },
                                    "usage_metadata": {
                                    "reusable": true,
                                    "becomes_dataset": false,
                                    "referenced_by": ["req_002", "req_005"],
                                    "feeds_into": ["fact_002", "insight_001"],
                                    "archival_status": "active"
                                    },
                                    "relationships": {
                                    "source_datasets": ["dataset_001"],
                                    "generated_facts": ["fact_001", "fact_002"],
                                    "linked_contexts": ["ctx_001"],
                                    "parent_results": [],
                                    "derived_results": ["result_003"]
                                    },
                                    "computational_details": {
                                    "processing_time": "2.3_seconds",
                                    "memory_used": "45MB",
                                    "compute_resources": "standard",
                                    "optimization_applied": true,
                                    "cache_status": "cached_for_reuse"
                                    }
                                 }
                              }
                              }
    - Conversation       --> the flow of conversations and data analytics - main context reliability
                         --> {
                              "conversation": {
                                 "conv_001": {
                                    "conversation_id": "conv_001",
                                    "header": "conv_000", 
                                    "timestamp": "2025-01-15T10:30:00Z",
                                    "main_topic": "west_region_revenue_growth_analysis",
                                    "request_id": "req_001",
                                    "response_id": "res_001",
                                    "datasets_linked": ["dataset_001", "dataset_002"],
                                    "scripts_linked": ["script_001", "script_003"],
                                    "context_linked": ["ctx_001", "ctx_003"]
                                 },
                                 "conv_002": {
                                    "conversation_id": "conv_002",
                                    "header": "conv_001",
                                    "timestamp": "2025-01-15T11:15:22Z", 
                                    "main_topic": "seasonal_factors_impact_analysis",
                                    "request_id": "req_002",
                                    "response_id": "res_002",
                                    "datasets_linked": ["dataset_001"],
                                    "scripts_linked": ["script_002"],
                                    "context_linked": ["ctx_001", "ctx_004"]
                                 }
                              }
                              }

    - many more .....
    - RULES for Context Engine - v0
    ContextEngine Rules for Each Sub-Type
      1. datasets

      Auto-assign unique ID (dataset_001, dataset_002...)
      Extract all column metadata with types, descriptions, units, ranges
      Track relationships between datasets (joins, derivations)
      Monitor quality metrics (completeness, accuracy, freshness)
      Store source information and creation timestamps

      2. facts

      Maximum detail retention - statistical values, calculations, confidence
      Link to source datasets and specific attributes used
      Include comparative context (peer comparisons, benchmarks, trends)
      Store statistical significance metrics and validation results
      Track extraction metadata and relationship mappings

      3. context

      Store situational information from user input or reliable external sources
      Assign relevance and confidence scores for each context
      Link to applicable datasets, facts, and requests
      Include quantitative and qualitative impact factors
      Track validation status and source credibility

      4. requests

      Capture complete user query with intent classification
      Track data requirements and analysis scope
      Store processing metadata and complexity scores
      Link to all generated entities (facts, scripts, results)
      Maintain user context and session information

      5. scripts

      Store complete executable code with dependencies
      Track execution metadata (timing, status, version)
      Include parameter configurations and validation results
      Monitor performance metrics and optimization scores
      Link to triggering requests and generated results

      6. results

      Capture complete output data from script execution
      Include quality assessment and validation metrics
      Store output artifacts and visualization references
      Track reusability and relationship mappings
      Monitor computational performance details

      7. conversation

      Header defaults to previous conv_id (conv_n-1)
      Link to single request-response pair per conversation node
      Track all entities used (datasets, scripts, contexts)
      Assign main topic for easy retrieval
      Maintain chronological timestamps for session flow
      RetryClaude does not have the ability to run the code it generates yet.Claude can make mistakes. Please double-check responses.

 - CoTAS
    - Chain of Thought Action and Search
    - Thought - the usual
    - Action - Creating a script , analyzing its results - Creating visualizations - Identifying patterns etc
    - Search - Hunting for Specific Context <'what happened in the oil markets on 2nd july 2025' kinda questions > and using thought to assosciate that to some change.
    - Not linking it to a specific workflow but instead giving the llm free flow over the above restricted tool collection in any order till desired output is met

 - File Support
    - the user must be able to upload a wide variety of files both Context and raw-data
    - MVP - support xls , csv , json , pdf and sql

 - Clarify
    - Applications for this include high risk industries
    - its important for the model to request for clarification of clearly say no whenever needed

Front-End-Design
 - Chat primarily
 - Context widget on the right
 - File viewing widget on the right
 - Script execution on the right - the code should be printed and an execution button on top
 - Widgets must be naturally appearing
 - the flow must be i must click on a button that either comes as a button in the chatwindow or on the ContextWidegt to open the file viewing and script execution
 - the context widget must be hideable - upon clicking a button it can be hid or seen

--- llm added ---
 - Execution
    - Subprocess-based execution for MVP
    - Supports pandas, numpy, matplotlib
    - Resource limits: timeout + memory cap
    - Captures:
       - stdout, stderr
       - structured stats (JSON)
       - visualizations (PNG)
       - transformed data (CSV)
    - Sandbox prevents unsafe OS/network calls
    - Upgrade path: Dockerized execution for stronger isolation

 - Free-Flow CoTAS
    - Iterative loop: Thought → Action → Inspect → Repeat
    - Cap iterations (e.g. max 5 loops per request)
    - Stop conditions:
       - LLM outputs "done"
       - Iteration limit reached
       - Clarification required
    - Allowed tools in MVP: pandas, numpy, matplotlib only
    - Produces standardized outputs each step

 - Clarify (extension)
    - Safety layer before final outputs
    - LLM requests missing context or says "no" if uncertain
    - Enforced in high-risk contexts (finance, healthcare, etc.)
    - Integrated at last stage of MVP

 - Context Persistence
    - After every iteration, LLM returns structured JSON:
    - Backend validates JSON
    - Automatically saves into ContextEngine buckets
    - Ensures nothing worth storing is lost

 - Artifacts
    - Standard folder convention per request:
       - /facts/ → extracted numerical/statistical facts (JSON)
       - /raw-data/ → dataset schema & metadata
       - /scripts/ → generated Python code
       - /results/ → plots (PNG), tables (CSV), logs
       - /reports/ → final summaries (Markdown/text)
    - Ensures reproducibility and auditability

 - LLM ↔ ContextEngine Interaction
    - LLM queries ContextEngine for prior facts, scripts, results
    - New context is appended automatically after each iteration
    - Requests/responses are logged for traceability
    - ContextEngine acts as persistent memory for all operations

 - Front-End (MVP)
    - HTML + CSS + Vanilla JS (minimal overhead)
    - Layout:
       - Chat window (center, ~70%)
       - Sidebar (right, ~30%) → toggleable
    - Sidebar Widgets (only one active at a time):
       - Context viewer (default)
       - File viewer (triggered via button in chat/context)
       - Script viewer & executor (shows code + "Run" button)
    - User Flow:
       - LLM outputs buttons in chat ("View File", "Run Script")
       - Clicking button opens corresponding sidebar widget
       - Execution results returned inline or stored in context
    - Sidebar controls:
       - Toggle show/hide
       - Switch between context/file/script widgets